---
title: "Comparing Jungle to Drum & Bass music"
author: "Skip Vial"
date: "Februari 2021"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---

```{r setup, include=FALSE}

library(tidyverse)
library(spotifyr)
library(usethis)
library(ggthemes)
library(compmus)
library(remotes)
library(plotly)
library(viridis)
library(hrbrthemes)
```

### Introduction

*Background*

The music genre ‘Jungle’ emerged in the 1990s and is viewed as the direct originating point for the newer music genre named ‘Drum & Bass’ (emerged mid 1990s). These two genres are commonly used as synonyms for one another. Almost 30 years have passed since these genres were developed. During this time the Drum & Bass genre has grown significantly in terms of exposure and now knows many subgenres, while Jungle music did not make the same growth and lost popularity. What caused this turn of events? Has Drum & Bass become more popular because of its diversity? Can we still use the terms ‘Jungle’ and ‘Drum & Bass’ as synonyms or has Drum & Bass developed in such a way that it has become completely different from its originating point? This corpus analysis attempts to answer these questions by comparing Jungle music to various subgenres of Drum & Bass music:

- Ragga Drum & Bass. This subgenre was inspired by the original Ragga Jungle style, which was very popular at the time. Expected is that this genre is most similar to the original Jungle music.

- Light Drum & Bass. Also called Liquid Drum & Bass. Many harmonic and melodic grooves are used, as well as samples from funk, jazz, soul, R&B. Expected is that this subgenre has significant differences from Jungle. Overall, Liquid Drum & Bass is known for its positive energy. This would mean that the acousticness and/or valence of songs are different than in Jungle music.

- Heavy Drum & Bass. This subgenre has a higher average BPM than most other subgenres and has a general ‘dark’ mood, which is realized with deeper basslines and more industrial, hardcore (electronic) melodies.

*** 

*Corpus*

This corpus uses genre-based Spotify Playlists.

- Jungle:
  - JUNGLE / RAGGA DNB / JUNGLE REVIVAL
  - Tracks: 125
  
- Ragga DnB: 
  - Ragga Drum and Bass
  - Tracks: 115
  
- Light DnB:
  - Liquid Drum and Bass 	
  - Tracks: 100
  
- Heavy DnB:
  - Neurofunk Drum & Bass
  - NEUROFUNK 2021 // Updated Weekly
  - Tracks: 113
  

```{r echo=FALSE}

### Import Spotify Playlists ###
Jungle <- get_playlist_audio_features("", "4Xq7CHKa693iezbOXH8NOQ")

RaggaDnB <- get_playlist_audio_features("", "0ix8qCnYCiu4w8OcnK0Uqu")

LightDnB <- get_playlist_audio_features("", "5ABMzUESx7K7EyowE5kFCl")

Heavy1 <- get_playlist_audio_features("", "7Dx1mjAUeV8ElB5FERajkl")
Heavy2 <- get_playlist_audio_features("", "0Po1Xhn50bsrQwyjXWMMKJ")


### Combine datasets per subgenre ###
HeavyDnB <-
  bind_rows(
    Heavy1 %>% mutate(category = "Heavy1"),
    Heavy2 %>% mutate(category = "Heavy2")
  )


### Final final universal dataframe ###
all_music <-
  bind_rows(
      Jungle %>% mutate(category = "Jungle"),
      RaggaDnB %>% mutate(category = "RaggaDnB"),
      LightDnB %>% mutate(category = "LightDnB"),
      HeavyDnB %>% mutate(category = "HeavyDnB")
  )

### Delete useless columns ###
all_music = subset(all_music, select = -c(playlist_id, playlist_img, playlist_owner_name,
                                    playlist_owner_id, track.id, analysis_url,
                                    is_local, primary_color, added_by.href,
                                    added_by.id, added_by.type, added_by.uri,
                                    added_by.external_urls.spotify, track.artists,
                                    track.available_markets, track.disc_number,
                                    track.episode, track.explicit, track.href,
                                    track.is_local, track.preview_url, track.track,
                                    track.track_number, track.type, track.uri,
                                    track.album.album_type, track.album.artists,
                                    track.album.available_markets, track.album.href,
                                    track.album.id, track.album.images, 
                                    track.album.name, added_at,
                                    track.album.release_date_precision,
                                    track.album.total_tracks, track.album.type,
                                    track.album.uri, track.album.external_urls.spotify,
                                    track.external_ids.isrc, 
                                    track.external_urls.spotify, video_thumbnail.url
                                    ))


```



### Which genre uses the most vocals?

```{r echo=FALSE}

# Histogram instrumentalness per genre
instrumentalness <- all_music %>%
  ggplot( aes(x=instrumentalness, 
              y=category, 
              fill=category, 
              color=category,)) +
    geom_violin(width=1.6, size=0.5) +
    labs(x = "Instrumentalness",
         title = "",
         subtitle = "The distribution of instrumentalness per genre",
         caption = "Figure 1"
         ) + 
    scale_fill_viridis(discrete=TRUE) +
    scale_color_viridis(discrete=TRUE) +
    theme_ipsum() +
    theme(
      legend.position="none",
      axis.title.y = element_blank()
    ) 

instrumentalness
```

***

Instrumentalness predicts whether a track contains vocals or not. A value of 0.5 or higher represents instrumental tracks which means that the track contains no vocal content. Figure 1 shows an expected pattern between the genres. The genres Jungle and RaggaDnB are very similar and both contain mostly vocal tracks. As HeavyDnB is known for its darker mood and deep basslines, which usually means that there is little room for vocals in a track. Results in Figure 1 confirm this. Lastly, instrumentalness values for the LightDnB genre show an even distribution. This indicates that there is a large variety of tracks within this genre regarding vocals.



### Is one genre more positive or energetic than the other?

```{r echo=FALSE}

# Scatterplot energy and valence
energy_valence <- ggplot(all_music, 
       aes(energy, 
           valence, 
           color = mode_name)) + # speechiness, acousticness, liveness?
  geom_point(position = "jitter", alpha = 0.4, shape = 20) +
  theme_light() +
  facet_wrap(~ category) +
    labs(     
    x = "Energy",
    y = "Valence",
    color = "Mode",
    title = "Energy, valence and mode per genre",
    caption = "Figure 2"
  )

energy_valence


```

***

The first genre that stands out in Figure 2 is HeavyDnB. As predicted, it becomes very clear that this genre consists mostly of tracks with very high energy and a general low valence. On the other hand, expected was that this genre would see a general high valence. However, Figure 2 shows that this is not the case. The amount of tracks with a high valence is approximately equal to the amount of tracks of the HeavyDnB genre. For Jungle and RaggaDnB was expected that these genres are very similar to each other. Both genres have a tendency for high energy and high valence. Lastly, mode was investigated to find additional patterns. Interestingly, mode is evenly distributed in every genre. This indicates that it does not have a significant effect on the valence or energy of a Drum & Bass track.



### Which genre is most popular? (In construction)

```{r}

# Attempt plot track popularity vs .... danceability, instrumentalness

test <- all_music %>% ggplot(aes(x = instrumentalness, 
                         y = track.popularity,
                         color = category,
                         size = speechiness
                         )) +
  geom_point(alpha = 0.5)  +
  geom_smooth() +
  geom_jitter(alpha = 0.5) +
  theme_light() +
  scale_x_continuous(
    limits = c(0, 1)
                     ) +
  scale_y_continuous(
    limits = c(0, 50)) 

test

```

***

In construction



### Chromagram Comparison 1 - What does the general build up of a Light Drum & Bass track look like?

```{r}

# Get track information
fall_to_you <-
  get_tidy_audio_analysis("1ObLc50qTIp8gF1Lg2GimH") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

# Make the chromagram. Use manhattan, euclidean, chebyshev
chroma_fall_to_you <- fall_to_you %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

# Add lines and text at key moments
chroma_fall_to_you +
  geom_vline(xintercept = 89,
             color = "red",
             size = 0.8) +
  geom_vline(xintercept = 200,
             color = "red",
             size = 0.8) + 
  geom_vline(xintercept = 223,
             color = "red",
             size = 0.8) +
  geom_vline(xintercept = 356,
             color = "red",
             size = 0.8) +
  annotate(geom="text", 
          x=89, 
          y="A", 
          label="First drop",
          color="red",
          fontface = 2,
          hjust=0) +
  annotate(geom="text", 
          x=200, 
          y="B", 
          label="Breakdown",
          color="red",
          fontface=2,
          hjust=1) +
  annotate(geom="text", 
          x=223, 
          y="A", 
          label="Second drop",
          color="red",
          fontface=2,
          hjust=0) +
  annotate(geom="text", 
          x=356, 
          y="B", 
          label="Breakdown",
          color="red",
          fontface=2,
          hjust=1)


```

***

*Track: Falls to you VIP - Calibre*

This track was chosen because it shows some aspects that usually are present in Light Drum & Bass tracks. The intro of the song lasts from the beginning until the first drop. What stands out here is that the intro is relatively long, it lasts approximately 90 seconds. Light Drum & Bass tracks usually have a longer intro than other genres because the average build up is very slow. 

The middle part of the song starts after the first drop. This is usually the part where a consistent 'Drum & Bass' drum pattern is played until the next breakdown. A number of samples are then layered on top of each other. This creates the unique sound of the song. The samples used in this genre contains a lot of harmonic and melodic grooves, which makes this genre very pleasant to listen to.
This pattern of a drop followed by a breakdown is then repeated one more time. There could be small variations of the samples used, but in general, this second part sounds the same as the first.

After the second breakdown, one final chord is played to indicate that the song has come to an end. This is the typical way a Light Drum & Bass track ends.



### Chromagram Comparison 2 - And for Heavy Drum & Bass?

```{r}

# Get track information
faceless <-
  get_tidy_audio_analysis("2m40HRbLhNf3FeH9ntqQWw") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)



# Make the chromagram. Use manhattan, euclidean, chebyshev
chroma_faceless <- faceless %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL , fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

# Add lines and text at key moments
chroma_faceless +
  geom_vline(xintercept = 40,
             color = "red",
             size = 0.8) +
  geom_vline(xintercept = 110,
             color = "red",
             size = 0.8) + 
  geom_vline(xintercept = 133,
             color = "red",
             size = 0.8) +
  geom_vline(xintercept = 207,
             color = "red",
             size = 0.8) +
  annotate(geom="text", 
          x=40, 
          y="A", 
          label="First drop",
          color="red",
          fontface = 2,
          hjust=0) +
  annotate(geom="text", 
          x=110, 
          y="B", 
          label="Breakdown",
          color="red",
          fontface=2,
          hjust=1) +
  annotate(geom="text", 
          x=133, 
          y="A", 
          label="Second drop",
          color="red",
          fontface=2,
          hjust=0) +
  annotate(geom="text", 
          x=207, 
          y="B", 
          label="Breakdown",
          color="red",
          fontface=2,
          hjust=1)


```

***

*Track: Faceless - Phace, Was A Be*

The intro of this song shows how a typical Heavy Drum & Bass track starts. The drops are usually more intense. This means that the build up to the drop starts early in the song. You can see this in the first part of the chromagram. The notes that are played (yellow) seem to have a staircase-like form. Playing a higher note each time will make the listener anticipate more and more to the drop. 

The middle part of tracks are unique in the sense that the underlying 'Drum & Bass' drum pattern becomes harder to recognize. Lots of deep basslines and samples with heavy electronic melodies are used in this part. Also, vocals are not used. This is why the chromagram looks so consistent.
Nothing interesting happens after the first breakdown. Just a few tones are played, and after a while a similar build up as before the first drop is used to anticipate towards the second drop.

The ending of the track starts after the second breakdown. Sometimes a Heavy Drum & Bass track ends instantly after the second breakdown. But in this case, a final sample (which still sounds pretty restless) is introduced prior to the breakdown. At some point the main samples stop, and the final sample is played for a short time before ending.



### Chromagram Comparison 3 - Now, what is different in the build up of a typical Jungle song?

```{r}

# Get track information
good_enough <-
  get_tidy_audio_analysis("6tTn8EkWFZJHkuDXLI3Hzg") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

# Make the chromagram. Use manhattan, euclidean, chebyshev
chroma_good_enough <- good_enough %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

# Add lines and text at key moments
chroma_good_enough +
  geom_vline(xintercept = 45,
             color = "red",
             size = 0.8) +
  geom_vline(xintercept = 154,
             color = "red",
             size = 0.8) + 
  geom_vline(xintercept = 176,
             color = "red",
             size = 0.8) +
  geom_vline(xintercept = 265,
             color = "red",
             size = 0.8) +
  annotate(geom="text", 
          x=45, 
          y="A", 
          label="First drop",
          color="red",
          fontface = 2,
          hjust=0) +
  annotate(geom="text", 
          x=154, 
          y="B", 
          label="Breakdown",
          color="red",
          fontface=2,
          hjust=1) +
  annotate(geom="text", 
          x=176, 
          y="A", 
          label="Second drop",
          color="red",
          fontface=2,
          hjust=0) +
  annotate(geom="text", 
          x=265, 
          y="B", 
          label="Breakdown",
          color="red",
          fontface=2,
          hjust=1)

```

***

*Track: Good Enough - Serial Killaz*

This track would be the average 'Jungle' track. A 'Drum & Bass' drum pattern starts a few seconds after the song begins. Unfortunately, this is not really visible in the chromagram.

In this genre, drops are usually introduced by vocals. The vocal part begins, and a bassline is added so that the track sounds more 'complete'. The chromagram's pattern of the middle parts of this track seem different when compared to the other tracks discussed, because vocals are included here. The vocals and the samples have their own sound, this is why multiple notes show a high magnitude (yellow). 

It is common for Jungle tracks to end the song by using the same samples as in the intro of the track.



### Conclusion / Discussion (In construction)

In construction

***

Panel is in construction
